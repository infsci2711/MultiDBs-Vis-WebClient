<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Visualization | Col*Fusion</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- styles -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="newCss/newDashboard.css">	


    <!-- script -->
    <script src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <!-- PLUG-IN -->
    <!-- http://bootboxjs.com/ -->
   	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>

   	<!-- datatable jquery -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
	<script src="https://cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
	


</head>
<body>
	<!-- nav bar -->
	<nav class="navbar navbar-inverse" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<div class="navbar-brand">Col*Fusion Canvas Manager</div>
		</div>
	
		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse navbar-ex1-collapse">
			<ul class="nav navbar-nav">
				<li><a href="#"></a></li>
				<li><a href="#"></a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#">Welcome <div id="userName"></div></a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>
	<!-- nav bar end -->

	<div id="file_manager">
		<div class="row">
			<div class="alert alert-info">
            <strong>How To Use: </strong>
            Firstly add some stories in Story Respository. Then you can use stories in respository to make new canvas.
        	</div>
		</div>

		<div class="row">
			<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
				<div class="story_respository well">
					<div class="story_resTitle row">
						<h4>Story Respository</h4>
						<span data-toggle="modal" data-target="#newStory" class="glyphicon glyphicon-plus"></span>
					</div>
					
					<ul class="list-group">
						<!-- <li class="list-group-item" story-id="1">Story 1<span class="glyphicon glyphicon-trash"></span></li>
						<li class="list-group-item" story-id="2">Story 2<span class="glyphicon glyphicon-trash"></span></li> -->
					</ul>
				</div>
				<script>
					$('.list-group').css('height', $(document).height()*0.6);
					$(window).resize(function(event) {
						/* Act on the event */
						$('.list-group').css('height', $(document).height()*0.6);
					});
				</script>
			</div>

			<div class="col-xs-9 col-sm-9 col-md-9 col-lg-9">
				<div class="well">
					<table id="canvas-table" class="stripe row-border hover order-column">
						<thead>
							<tr>
								<th>vid</th>
								<th>name</th>
								<th>mdate</th>
								<th>cdate</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>

		</div>
		
		
    <!--     <div id="filter_section">
            <div id = "charts_section" class = 'round' style="display:none">
                <div id = "display_charts"></div>
                <div id = "openbutton_section">
                    <button id="openButton" class="btn btn-info" type="button" > OpenCanvas</button>
                </div>  
            </div>
            
            <div class="panel panel-default">
				
				<div class="panel-heading">AUTHORIZATION FILTER:</div>
				<ul class="list-group">
				    <li class="list-group-item"><a href="">Readable</a></li>
				    <li class="list-group-item"><a href="">Modifiable</a></li>
				    <li class="list-group-item"><a href="">User Owned</a></li>
  				</ul>
			</div> 
        </div>

        <div id="button_section" class='well'>
            <label class="label_header">Search by Canvas Name: &nbsp;</label>
            <input class="input_round" type="text" name="searchText" width="300">
            <button type="button" id="delete" class="btn btn-default btn-danger">Delete<span class="glyphicon glyphicon-trash"></span></button>
            <button type="button" data-target="#newCanvas" class="btn btn-default btn-primary" data-toggle="modal">New Canvas<span class="glyphicon glyphicon-plus"></span></button>
        </div>	

        <div id="display_section" class='round'>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th class="col-md-4">Canvas Name</th>
                        <th class="col-md-6">Note</th>
                        <th class="col-md-2" id="selectedNumber">Operation</th>
                    </tr> 
                </thead>
                <tbody>
                    <tr>
                    	<td>test</td>
                        <td>This is for test</td>
                        <td>
                        	<span class="edit glyphicon glyphicon-pencil" ></span>
                        	<span class="delete glyphicon glyphicon-trash"></span>
                     	</td>
                    </tr>     
                </tbody>
            </table>
        </div>	 -->
	</div>

	<!-- New Story in Respository -->
	<div class="modal fade" id="newStory" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">Create a New Story</h4>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="form-group">
	            <!-- <label for="recipient-name" class="control-label">Name: </label>
	            <div class="row">
	            	<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
	            		<input type="text" class="form-control" id="name-text">
	            	</div>
	            </div> -->
	            
	          </div>
	          <div class="form-group">
	            <label for="message-text" class="control-label">Connect Information: </label>
	            <textarea class="form-control" id="note-text"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button  type="button" class="confirm btn btn-primary">Create</button>
	      </div>
	    </div>
	  </div>
	</div>








	<!-- New Canvas -->
	<div class="modal fade" id="newCanvas" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">Create a New Canvas</h4>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="form-group">
	            <label for="recipient-name" class="control-label">Name: </label>
	            <div class="row">
	            	<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
	            		<input type="text" class="form-control" id="name-text">
	            	</div>
	            </div>
	            
	          </div>
	          <div class="form-group">
	            <label for="message-text" class="control-label">Note: </label>
	            <textarea class="form-control" id="note-text"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button id="createNewCanvasBtn" type="button" class="btn btn-primary">Create</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- Edit Canvas -->
	<div class="modal fade" id="editCanvas" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">Edit Canvas</h4>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="form-group">
	            <label for="recipient-name" class="control-label">Name: </label>
	            <div class="row">
	            	<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
	            		<input type="text" class="form-control" id="name-text">
	            	</div>
	            </div>
	            
	          </div>
	          <div class="form-group">
	            <label for="message-text" class="control-label">Note: </label>

	            <textarea class="form-control" id="note-text"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button id="saveCanvasBtn" type="button" class="btn btn-primary">Save</button>
	      </div>
	    </div>
	  </div>
	</div>

</body>
<script>
	//get all data about this User
	//This part should use ajax
	var userJsonObj = {
		user_id: "23",
		user_names: "Haoda",
		story: [
			{sid: "1", conninfo: "test1"},
			{sid: "2", conninfo: "test2"}
		],
		canvas: [
			{
				vid: "1", 
				name: "canvas1",
				mdate: "2015-01-08 17:34:56",
				cdate: "2015-02-13 17:34:56"
			},
			{
				vid: "2", 
				name: "canvas2",
				mdate: "2015-03-18 17:34:56",
				cdate: "2015-03-18 17:34:56"
			},
			{
				vid: "3", 
				name: "testCanvas",
				mdate: "2015-02-08 17:34:56",
				cdate: "2014-12-21 17:34:56"
			}
		]
	};


	$('#userName').html(userJsonObj.user_names);
	//present story respository
	var storyArr = userJsonObj.story;
	for (var i = 0; i < storyArr.length; i++) {
		var sid = storyArr[i].sid;
		var conninfo = storyArr[i].conninfo;
		$('.story_respository .list-group').append(
				'<li sid="'+sid+'" conninfo="'+conninfo+'" class="list-group-item" story-id="1"><a>Story '+sid+'</a><span class="glyphicon glyphicon-trash"></span></li>'
			);
	}

	//delete story in respository
	$(document).on('click', '.list-group .glyphicon-trash', function(event) {
		event.preventDefault();
		/* Act on the event */
		var sid = $(this).parent().attr('sid');
		var selected = $(this).parent();
		bootbox.confirm("Are you sure to delete story "+sid, 
			function(result) {
  				if (result) {
  					//send a delete request using ajax
  					selected.remove();
  				}
			}); 
	});

	//Show connectInfo in respository
	$(document).on('click', '.list-group a', function(event) {
		event.preventDefault();
		/* Act on the event */
		var conninfo = $(this).parent().attr('conninfo');
		bootbox.dialog({
			title: "Connection Information",
			message: conninfo,
			buttons: {
				success: {
					label: "Close",
					className: "btn-primary",
				}
			}
		});
	});

	//create new story in respository
	$('#newStory .confirm').click(function(event) {
		/* Act on the event */
		var input = $('#newStory textarea').val();
		if ($.trim(input).length==0) {
			$('#newStory textarea').focus();
		}else{
			$('#newStory textarea').val('');
			$('#newStory').modal('hide');
			
			//send a newstory request using ajax
			
			var currentid = $('.story_respository .list-group li').last().attr('sid');

			var nextId = parseInt(currentid)+1;
			$('.story_respository .list-group').append(
				'<li sid="'+nextId+'" conninfo="'+input+'" class="list-group-item" story-id="1"><a>Story '+nextId+'</a><span class="glyphicon glyphicon-trash"></span></li>'
			);
		}
	});

	//canvas table
	$('#canvas-table').DataTable({
		paging: false,
		data: userJsonObj.canvas,
		columns: [
	        { data: 'vid' },
	        { data: 'name' },
	        { data: 'mdate' },
	        { data: 'cdate' }
    	]
	});

</script>
</html>