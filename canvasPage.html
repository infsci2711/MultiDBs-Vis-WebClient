<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Visualization | Col*Fusion</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- styles -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="newCss/newDashboard.css">	


    <!-- script -->
     <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>


    <script src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <!-- PLUG-IN -->
    <!-- http://bootboxjs.com/ -->
   	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>

   	<!-- datatable jquery -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
	<script src="https://cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
            <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1', {'packages': ['table', 'map', 'corechart']});
      google.setOnLoadCallback(initialize);
        </script>
	



</head>
<body>
    <table>
        <tr>
            <td width="150 px"></td>
            <td width="1000 px">
	<!-- nav bar -->
	<nav class="navbar navbar-inverse" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<div class="navbar-brand">Col*Fusion Canvas Manager</div>
		</div>
               
		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse navbar-ex1-collapse">
			<ul class="nav navbar-nav">
				<li><a href="#"></a></li>
				<li><a href="#"></a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#">Welcome <div id="userName"></div></a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>
	<!-- nav bar end -->
            </td>
        </tr>
        <tr>
            <td></td>
            <td width="100%" >
	<div id="file_manager">
		<div class="row">
			<div class="alert alert-info">
            <strong>How To Use: </strong>
            Firstly add some stories in Story Respository. Then you can use stories in respository to make new canvas.
            <select onchange="test(this);">
  <option value="Add">Add</option>
  <option value="Table">Add Table</option>
  <option value="BarChart">Bar Chart</option>
  <option value="PieChart">Add Pi Chart</option>
  <option value="MotionChart">Add Motion Chart</option>
  <option value="Map">Add Map</option>
</select>
        	</div>
		</div>
        </td>
        </tr>
        <tr></tr>
        <tr>
            
            <td>
         
		<div class="row">
			<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
				<div class="story_respository well">
					<div class="story_resTitle row">
						<h4>Story Respository</h4>
						<span data-toggle="modal" data-target="#newStory" class="glyphicon glyphicon-plus"></span>
                                                
					</div>
					
                                    
				</div>
				<script>
					$('.list-group').css('height', $(document).height()*0.6);
					$(window).resize(function(event) {
						/* Act on the event */
						$('.list-group').css('height', $(document).height()*0.6);
					});
				</script>
			</div>

			

		</div>
		
            
    
	
            
	<!-- New Story in Respository -->
	<div class="modal fade" id="newStory" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">Create a New Story</h4>
	      </div>
	      <div class="modal-body">
	        <form>
	          
	          <div class="form-group">
	            <label for="message-text" class="control-label">Connect Information: </label>
	            <textarea class="form-control" id="note-text"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button  type="button" class="confirm btn btn-primary">Create</button>
	      </div>
	    </div>
	  </div>
	</div>








	<!-- New Canvas -->
	<div class="modal fade" id="newCanvas" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">Create a New Canvas</h4>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="form-group">
	            <label for="recipient-name" class="control-label">Name: </label>
	            <div class="row">
	            	<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
	            		<input type="text" class="form-control" id="name-text">
	            	</div>
	            </div>
	            
	          </div>
	          <div class="form-group">
	            <label for="message-text" class="control-label">Note: </label>
	            <textarea class="form-control" id="note-text"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button id="createNewCanvasBtn" type="button" class="btn btn-primary">Create</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- Edit Canvas -->
	<div class="modal fade" id="editCanvas" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">Edit Canvas</h4>
	      </div>
	      <div class="modal-body">
	        <form>
	          <div class="form-group">
	            <label for="recipient-name" class="control-label">Name: </label>
	            <div class="row">
	            	<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
	            		<input type="text" class="form-control" id="name-text">
	            	</div>
	            </div>
	            
	          </div>
	          <div class="form-group">
	            <label for="message-text" class="control-label">Note: </label>

	            <textarea class="form-control" id="note-text"></textarea>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button id="saveCanvasBtn" type="button" class="btn btn-primary">Save</button>
	      </div>
	    </div>
	  </div>
	</div>
            </td>
        </tr>
        <tr>
            <td width="150 px">nnnnnnnnn</td>
            <td > <div id="drawing" style="width: 400px; height: 400px;"></div></td>
        </tr>
    </table>
       <script>
      
  $(document).ready(function() {
    $("#drawing").dialog();
  });
</script>
</body>

<script>
    
	//get all data about this User
	//This part should use ajax
	var userJsonObj = {
		user_id: "23",
		user_names: "Haoda",
		story: [
			{sid: "1", conninfo: "test1"},
			{sid: "2", conninfo: "test2"}
		],
		canvas: [
			{
				vid: "1", 
				name: "canvas1",
				mdate: "2015-01-08 17:34:56",
				cdate: "2015-02-13 17:34:56"
			},
			{
				vid: "2", 
				name: "canvas2",
				mdate: "2015-03-18 17:34:56",
				cdate: "2015-03-18 17:34:56"
			},
			{
				vid: "3", 
				name: "testCanvas",
				mdate: "2015-02-08 17:34:56",
				cdate: "2014-12-21 17:34:56"
			}
		],
                ChartData: [
			{
				vid: "1", 
				name: "canvas1",
				mdate: "2015-01-08 17:34:56",
				cdate: "2015-02-13 17:34:56"
			},
			{
				vid: "2", 
				name: "canvas2",
				mdate: "2015-03-18 17:34:56",
				cdate: "2015-03-18 17:34:56"
			},
			{
				vid: "3", 
				name: "testCanvas",
				mdate: "2015-02-08 17:34:56",
				cdate: "2014-12-21 17:34:56"
			}
		]
	};


	$('#userName').html(userJsonObj.user_names);
	//present story respository
	var storyArr = userJsonObj.story;
	for (var i = 0; i < storyArr.length; i++) {
		var sid = storyArr[i].sid;
		var conninfo = storyArr[i].conninfo;
		$('.story_respository .list-group').append(
				'<li sid="'+sid+'" conninfo="'+conninfo+'" class="list-group-item" story-id="1"><a>Story '+sid+'</a><span class="glyphicon glyphicon-trash"></span></li>'
			);
	}

	//delete story in respository
	$(document).on('click', '.list-group .glyphicon-trash', function(event) {
		event.preventDefault();
		/* Act on the event */
		var sid = $(this).parent().attr('sid');
		var selected = $(this).parent();
		bootbox.confirm("Are you sure to delete story "+sid, 
			function(result) {
  				if (result) {
  					//send a delete request using ajax
  					selected.remove();
  				}
			}); 
	});

	//Show connectInfo in respository
	$(document).on('click', '.list-group a', function(event) {
		event.preventDefault();
		/* Act on the event */
		var conninfo = $(this).parent().attr('conninfo');
		bootbox.dialog({
			title: "Connection Information",
			message: conninfo,
			buttons: {
				success: {
					label: "Close",
					className: "btn-primary",
				}
			}
		});
	});

	//create new story in respository
	$('#newStory .confirm').click(function(event) {
		/* Act on the event */
		var input = $('#newStory textarea').val();
		if ($.trim(input).length==0) {
			$('#newStory textarea').focus();
		}else{
			$('#newStory textarea').val('');
			$('#newStory').modal('hide');
			
			//send a newstory request using ajax
			
			var currentid = $('.story_respository .list-group li').last().attr('sid');

			var nextId = parseInt(currentid)+1;
			$('.story_respository .list-group').append(
				'<li sid="'+nextId+'" conninfo="'+input+'" class="list-group-item" story-id="1"><a>Story '+nextId+'</a><span class="glyphicon glyphicon-trash"></span></li>'
			);
		}
	});

	//canvas table
	$('#canvas-table').DataTable({
		paging: false,
		data: userJsonObj.canvas,
		columns: [
	        { data: 'vid' },
	        { data: 'name' },
	        { data: 'mdate' },
	        { data: 'cdate' }
    	]
	});
window.test = function(e){
    if(e.value=="Table"){
        
        this.drawTable();
        //call here any function
    }
    else if(e.value=="PieChart"){
        drawPiChart();
        v//call here any function       
    }
    else if(e.value == "AN03"){
        alert(e.value);
       //call here any function
    }
}
function drawTable() {
    alert("mmmm");
  var data = new google.visualization.DataTable();
  data.addColumn('string', 'Name');
  data.addColumn('number', 'Salary');
  data.addColumn('boolean', 'Full Time');
  data.addRows(5);
  data.setCell(0, 0, 'John');
  data.setCell(0, 1, 10000, '$10,000');
  data.setCell(0, 2, true);
  data.setCell(1, 0, 'Mary');
  data.setCell(1, 1, 25000, '$25,000');
  data.setCell(1, 2, true);
  data.setCell(2, 0, 'Steve');
  data.setCell(2, 1, 8000, '$8,000');
  data.setCell(2, 2, false);
  data.setCell(3, 0, 'Ellen');
  data.setCell(3, 1, 20000, '$20,000');
  data.setCell(3, 2, true);
  data.setCell(4, 0, 'Mike');
  data.setCell(4, 1, 12000, '$12,000');
  data.setCell(4, 2, false);

  var table = new google.visualization.Table(document.getElementById('drawing'));
  table.draw(data, {showRowNumber: true});

  google.visualization.events.addListener(table, 'select', function() {
    var row = table.getSelection()[0].row;
    alert('You selected ' + data.getValue(row, 0));
  });
}
   function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ['Year', 'Visitations', { role: 'style' } ],
        ['2010', 10, 'color: gray'],
        ['2010', 14, 'color: #76A7FA'],
        ['2020', 16, 'opacity: 0.2'],
        ['2040', 22, 'stroke-color: #703593; stroke-width: 4; fill-color: #C5A5CF'],
        ['2040', 28, 'stroke-color: #871B47; stroke-opacity: 0.6; stroke-width: 8; fill-color: #BC5679; fill-opacity: 0.2']
      ]);
  }
  function drawPiChart() {

        var data = google.visualization.arrayToDataTable([
          ['Task', 'Hours per Day'],
          ['Work',     11],
          ['Eat',      2],
          ['Commute',  2],
          ['Watch TV', 2],
          ['Sleep',    7]
        ]);

        var options = {
          title: 'My Daily Activities'
          
            
        };

        var chart = new google.visualization.PieChart(document.getElementById('drawing'));

        chart.draw(data, options);
      }
</script>
</html>